# Настройка транскрибации голосовых сообщений

## Обзор

Транскрибация голосовых сообщений работает через **OpenRouter API**. 
Мы используем только OpenRouter для ВСЕХ AI-интеграций (текстовая генерация + транскрибация).

## Решение

### Шаг 1: Убедитесь, что OpenRouter API ключ настроен

Откройте файл `.env` и проверьте наличие:

```env
OPENROUTER_API_KEY=sk-or-v1-ваш_ключ_здесь
OPENROUTER_MODEL=gpt-4o
```

**ВАЖНО:** Отдельный ключ OpenAI НЕ требуется! Используется только OpenRouter.

### Шаг 2: Перезапустите бота

```bash
# Перезапустите Docker контейнеры
docker compose restart bot

# Или если используете docker-compose
docker-compose restart bot
```

### Шаг 3: Проверьте логи

```bash
# Посмотрите логи, чтобы убедиться, что транскрибация работает
docker compose logs -f bot | grep -i "transcri\|voice"
```

## Проверка работы

1. Откройте бота в Telegram
2. Отправьте `/start`
3. Выберите любую роль
4. На текстовом вопросе отправьте голосовое сообщение
5. Бот должен распознать речь и показать текст

## Если всё ещё не работает

### Проверьте, что ключ правильный:

```bash
# Проверьте, что переменная окружения загружена в контейнер
docker compose exec bot env | grep OPENROUTER
```

Должно вывести:
```
OPENROUTER_API_KEY=sk-or-v1-...
OPENROUTER_MODEL=gpt-4o
```

### Проверьте баланс на аккаунте OpenRouter:

1. Перейдите на https://openrouter.ai/settings/usage
2. Убедитесь, что у вас есть доступные средства (credits)

### Типичные ошибки:

**Ошибка 1:** `OpenRouter API key not configured for transcription`
- **Решение:** Добавьте `OPENROUTER_API_KEY` в `.env`

**Ошибка 2:** `401 Unauthorized`
- **Решение:** Проверьте, что ключ OpenRouter правильный и активный

**Ошибка 3:** `429 Rate limit exceeded`
- **Решение:** Превышен лимит запросов, подождите или увеличьте лимит в настройках OpenRouter

**Ошибка 4:** `Insufficient credits`
- **Решение:** Пополните баланс на https://openrouter.ai/settings/credits

## Стоимость

**Whisper Large V3 через OpenRouter** стоит примерно **$0.006 за минуту** аудио.

Пример:
- 1 голосовое сообщение (5 секунд) ≈ $0.0005
- 100 голосовых сообщений ≈ $0.05
- 1000 голосовых сообщений ≈ $0.50

## Архитектура

Все AI-интеграции в проекте используют **только OpenRouter**:

- **Текстовая генерация:** OpenRouter → GPT-4o
- **Транскрибация аудио:** OpenRouter → Whisper Large V3
- **Единый API ключ:** `OPENROUTER_API_KEY`

Это упрощает управление и снижает количество зависимостей.

---

**Сделано с ❤️ в rusneurosoft.ru**
