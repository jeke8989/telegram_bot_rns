# üì¢ –°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—Å—ã–ª–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—Å—ã–ª–æ–∫ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –±–æ—Ç–∞. –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –∫–æ–≥–¥–∞-–ª–∏–±–æ –∑–∞–ø—É—Å–∫–∞–ª–∏ –±–æ—Ç–∞ –∫–æ–º–∞–Ω–¥–æ–π `/start`, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `users`.

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `users`

–•—Ä–∞–Ω–∏—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–æ—Ç–∞ –¥–ª—è —Ä–∞—Å—Å—ã–ª–æ–∫:

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    telegram_id BIGINT UNIQUE NOT NULL,
    first_name VARCHAR(255),
    last_name VARCHAR(255),
    username VARCHAR(255),
    is_bot BOOLEAN DEFAULT FALSE,
    language_code VARCHAR(10),
    is_blocked BOOLEAN DEFAULT FALSE,           -- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞
    last_interaction TIMESTAMP WITH TIME ZONE,  -- –ü–æ—Å–ª–µ–¥–Ω–µ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### –û—Ç–ª–∏—á–∏–µ –æ—Ç —Ç–∞–±–ª–∏—Ü—ã `contacts`

- **`users`** - –í–°–ï –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—É—Å—Ç–∏–ª–∏ –±–æ—Ç–∞ (–¥–ª—è —Ä–∞—Å—Å—ã–ª–æ–∫)
- **`contacts`** - –¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ø—Ä–æ—à–µ–¥—à–∏–µ –æ–ø—Ä–æ—Å –∏ –ø–æ–¥–µ–ª–∏–≤—à–∏–µ—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ —Ä–∞—Å—Å—ã–ª–∫–∏

### 1. –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```bash
# –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker compose exec bot python broadcast.py --stats

# –õ–æ–∫–∞–ª—å–Ω–æ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ë–î)
python broadcast.py --stats
```

**–í—ã–≤–æ–¥:**
```
==================================================
üìä USER STATISTICS
==================================================
Total users: 150
Active users: 142
Blocked users: 8
==================================================
```

### 2. –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–∞—Å—Å—ã–ª–∫–∏

```bash
# –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker compose exec bot python broadcast.py "–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–¥–µ—Å—å"

# –° Markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
docker compose exec bot python broadcast.py "**–í–∞–∂–Ω–æ!** –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤ –±–æ—Ç–µ: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /roulette"
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –°–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∂–µ—Ç –ø—Ä–µ–≤—å—é —Å–æ–æ–±—â–µ–Ω–∏—è
2. –ó–∞–ø—Ä–æ—Å–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (–≤–≤–µ–¥–∏—Ç–µ `yes`)
3. –ù–∞—á–Ω–µ—Ç —Ä–∞—Å—Å—ã–ª–∫—É —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
4. –ü–æ–∫–∞–∂–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –∫–æ–Ω—Ü–µ

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
==================================================
BROADCAST MESSAGE:
–ü—Ä–∏–≤–µ—Ç! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é - —Ä—É–ª–µ—Ç–∫—É –ø—Ä–∏–∑–æ–≤! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /roulette
==================================================
Are you sure you want to send this message to all users? (yes/no): yes

Starting broadcast to 142 users...
[1/142] Sending to –ò–≤–∞–Ω (ID: 123456789)
[2/142] Sending to –ú–∞—Ä–∏—è (ID: 987654321)
...

==================================================
Broadcast completed!
Total users: 142
‚úÖ Successfully sent: 140
‚ùå Failed: 2
üö´ Blocked: 2
==================================================
```

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞, —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ü–æ–º–µ—Ç–∏—Ç –µ–≥–æ –∫–∞–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤ –ë–î (`is_blocked = TRUE`)
2. –ù–µ –±—É–¥–µ—Ç –ø—ã—Ç–∞—Ç—å—Å—è –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –±—É–¥—É—â–∏—Ö —Ä–∞—Å—Å—ã–ª–∫–∞—Ö

## API –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### –í –∫–æ–¥–µ –±–æ—Ç–∞ (Python)

```python
from database import Database

db = Database(config.database_url)
await db.connect()

# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
users = await db.get_all_users(exclude_blocked=True)

# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
stats = await db.get_users_count()
# –í–µ—Ä–Ω–µ—Ç: {'total': 150, 'active': 142, 'blocked': 8}

# –ü–æ–º–µ—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–∞–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ
await db.mark_user_blocked(telegram_id=123456789)

# –ü–æ–º–µ—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ
await db.mark_user_active(telegram_id=123456789)
```

## SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

### –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```sql
SELECT telegram_id, first_name, username, created_at 
FROM users 
WHERE is_blocked = FALSE 
ORDER BY created_at DESC;
```

### –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π

```sql
SELECT COUNT(*) as new_users
FROM users
WHERE created_at >= NOW() - INTERVAL '7 days';
```

### –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –¥–∞–≤–Ω–æ –Ω–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞–ª–∏ —Å –±–æ—Ç–æ–º

```sql
SELECT telegram_id, first_name, last_interaction
FROM users
WHERE last_interaction < NOW() - INTERVAL '30 days'
AND is_blocked = FALSE
ORDER BY last_interaction ASC;
```

## –õ–∏–º–∏—Ç—ã Telegram

- **–°–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏:** –î–æ 30 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É
- –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª–∞–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É 0.05 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- –ü—Ä–∏ –±–æ–ª—å—à–∏—Ö —Ä–∞—Å—Å—ã–ª–∫–∞—Ö (1000+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π) –ø—Ä–æ—Ü–µ—Å—Å –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–ê–ñ–ù–û:**
- –†–∞—Å—Å—ã–ª–∫—É –º–æ–∂–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ —Å–µ—Ä–≤–µ—Ä—É
- –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–ø–∞–º - —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –±–æ—Ç–∞ –≤ Telegram

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏

```bash
docker compose exec bot python broadcast.py "üéâ –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è!\n\n–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∫—Ä—É—Ç–∏—Ç—å —Ä—É–ª–µ—Ç–∫—É –ø—Ä–∏–∑–æ–≤ –∏ –ø–æ–ª—É—á–∏—Ç—å —Å–∫–∏–¥–∫—É –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –æ—Ç 5000 –¥–æ 30000 —Ä—É–±–ª–µ–π!\n\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /roulette"
```

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

```bash
docker compose exec bot python broadcast.py "‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!\n\n–ë–æ—Ç –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω —Å–µ–≥–æ–¥–Ω—è —Å 22:00 –¥–æ 23:00 –ú–°–ö –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è.\n\n–ü—Ä–∏–Ω–æ—Å–∏–º –∏–∑–≤–∏–Ω–µ–Ω–∏—è –∑–∞ –Ω–µ—É–¥–æ–±—Å—Ç–≤–∞."
```

### –ê–Ω–æ–Ω—Å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è

```bash
docker compose exec bot python broadcast.py "üìÖ –ü—Ä–∏–≥–ª–∞—à–∞–µ–º –Ω–∞ –Ω–∞—à–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ!\n\n**–î–∞—Ç–∞:** 15 —Ñ–µ–≤—Ä–∞–ª—è 2026\n**–í—Ä–µ–º—è:** 18:00 –ú–°–ö\n**–¢–µ–º–∞:** AI –≤ –±–∏–∑–Ω–µ—Å–µ\n\n–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏: https://rusneurosoft.ru/event"
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```sql
SELECT telegram_id, first_name, username, created_at
FROM users
ORDER BY created_at DESC
LIMIT 10;
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —è–∑—ã–∫–∞–º

```sql
SELECT language_code, COUNT(*) as users_count
FROM users
WHERE is_blocked = FALSE
GROUP BY language_code
ORDER BY users_count DESC;
```

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –∫–æ–º–∞–Ω–¥—É `/start`

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–†–µ—à–µ–Ω–∏–µ:** 
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ –ª–∏ –≤—ã —Å–ø–∞–º
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–Ω—Ç–µ–Ω—Ç —Ä–∞—Å—Å—ã–ª–æ–∫ –ø–æ–ª–µ–∑–µ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –†–∞—Å—Å—ã–ª–∞–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ —á–∞—â–µ 1-2 —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é

### –ü—Ä–æ–±–ª–µ–º–∞: –†–∞—Å—Å—ã–ª–∫–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker compose logs bot`

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–∞—Å—Å—ã–ª–æ–∫ (TODO)

–í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
- –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏
- –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ä–∞—Å—Å—ã–ª–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç)
- –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —è–∑—ã–∫—É/–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (TODO)

- –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–∫—Ä—ã—Ç–∏–π —Å–æ–æ–±—â–µ–Ω–∏–π
- CTR –ø–æ —Å—Å—ã–ª–∫–∞–º
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è –ø–æ—Å–ª–µ —Ä–∞—Å—Å—ã–ª–∫–∏
- –î–∏–Ω–∞–º–∏–∫–∞ —Ä–æ—Å—Ç–∞ –±–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
